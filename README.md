# ntvdm
NT Virtual DOS Machine. Not the real one, but this one runs on 64-bit Windows (x64 and ARM64)

This code emulates the i8086 and DOS well enough to run some command-line apps, including Turbo Pascal 1.00A,
Turbo Pascal 3.02A, masm V1.10, and link V2.00 (from MS-DOS v2.0). It also works with apps generated
by my BA BASIC compiler, which is the reason I wrote this -- so I could use scripts to tests that compiler
on Win64 machines. It runs both .COM and .EXE files. It also runs apps generated by Turbo Pascal and QuickBasic.

WordStar Professional Release 4 for DOS works aside from features that try to shell out to command.com.

It kinda sorta runs gwbasic -- the screen is a bit of a mess but BASIC apps load and run.

No graphics, sound, mouse, or anything else not needed for simple command-line apps.

i8086 emulation performance is similar to other C/C++ emulators.

I did validate that ntvdm works on Arm64 with both native and x64 binaries.

I can't vouch for 100% i8086 emulation because I can't find any apps that do that, unlike what's out there
for the 6502, 8080, Z80, and other earlier CPUs. But I have done a fair bit of testing and it works in
ways not documented by Intel but required by real-world apps. For example, repne with movs and other string
functions must work but isn't documented.

djl8086d.hxx is an 8086 disassembler that's used when tracing instructions. It's useful when debugging why
apps don't work properly.

Cycle counts are conditionally computed based on a #define in i8086.hxx. Using this, the emulator can
simulate running at a given clock rate. Cycle counts vary widely between various spec docs I found online,
and the code doesn't check for misaligned memory access, get details of mult/div correct, or otherwise
get any closer than about 25% of what would be accurate. It's in the ballpark.

    usage: ntvdm [arguments] <DOS executable> [arg1] [arg2]
      notes:
                -c     don't auto-detect cursor positioning and set the console to 80x25
                -i     trace instructions as they are executed (this is verbose!)
                -p     show performance information
                -s:X   speed in Hz. Default is 0, which is as fast as possible.
                       for 4.77Mhz, use -s:4770000
                -t     enable debug tracing to ntvdm.log
     [arg1] [arg2]     arguments after the .COM/.EXE file are passed to that command
      examples:
          ntvdm -c -t app.com foo bar
          ntvdm turbo.com
          ntvdm s:\github\MS-DOS\v2.0\bin\masm small,,,small
          ntvdm s:\github\MS-DOS\v2.0\bin\link small,,,small
